(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6769],{2669:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(95155),a=r(12115),s=r(20063),i=r(19672),l=r(3998),o=r(86948),c=r(35299),u=r(6132),d=r(42529);class h extends Error{}h.prototype.name="InvalidTokenError";var m=r(91593);let f=function(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),[r,f]=(0,a.useState)(!0),[g,v]=(0,a.useState)(null),[p,x]=(0,a.useState)(!1),{setToken:b,setAuthenticated:y,setUser:N}=(0,i.n)();if((0,a.useEffect)(()=>{(async()=>{try{f(!0);let r=e.get("token"),n=e.get("refresh_token"),a=e.get("error"),s=e.get("error_description");if(a){v(s||a),f(!1);return}if(!r){v("No authentication token received"),f(!1);return}let i=function(e,t){let r;if("string"!=typeof e)throw new h("Invalid token specified: must be a string");t||(t={});let n=+(!0!==t.header),a=e.split(".")[n];if("string"!=typeof a)throw new h(`Invalid token specified: missing part #${n+1}`);try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=t,decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return atob(t)}}(a)}catch(e){throw new h(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(r)}catch(e){throw new h(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}(r);console.log({decodedUser:i});let l=await fetch("/api/users/by-email?email=".concat(encodeURIComponent(i.email)));if(!l.ok){if(404===l.status){v("User not found. Please contact your administrator to set up your account."),f(!1);return}throw Error("Failed to fetch user data")}let o=await l.json();console.log({user:o}),b(r,n||""),y(!0),N(o),x(!0),setTimeout(()=>{switch(o.role){case m.Xh.ADMIN:case m.Xh.CEO:t.push("/admin/dashboard");break;case m.Xh.NORMAL:t.push("/normal/dashboard")}},1500)}catch(e){console.error("Auth callback error:",e),v("An unexpected error occurred during authentication")}finally{f(!1)}})()},[e,b,y,t,N]),r)return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,n.jsx)(o.Zp,{className:"w-full max-w-md",children:(0,n.jsxs)(o.aR,{className:"text-center",children:[(0,n.jsx)("div",{className:"flex justify-center mb-4",children:(0,n.jsx)(c.A,{className:"h-8 w-8 animate-spin text-primary"})}),(0,n.jsx)(o.ZB,{children:"Authenticating..."}),(0,n.jsx)(o.BT,{children:"Please wait while we complete your authentication"})]})})});if(g){let e=g.includes("User not found");return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,n.jsxs)(o.Zp,{className:"w-full max-w-md",children:[(0,n.jsxs)(o.aR,{className:"text-center",children:[(0,n.jsx)("div",{className:"flex justify-center mb-4",children:(0,n.jsx)(u.A,{className:"h-8 w-8 text-destructive"})}),(0,n.jsx)(o.ZB,{className:"text-destructive",children:e?"Account Not Found":"Authentication Failed"}),(0,n.jsx)(o.BT,{className:"text-destructive/80",children:g})]}),(0,n.jsxs)(o.Wu,{className:"text-center space-y-3",children:[e&&(0,n.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg",children:[(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Your email address is not registered in our system."}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please contact your system administrator to:"}),(0,n.jsxs)("ul",{className:"text-sm text-muted-foreground mt-2 space-y-1",children:[(0,n.jsx)("li",{children:"• Create your account"}),(0,n.jsx)("li",{children:"• Verify your email address"}),(0,n.jsx)("li",{children:"• Set up your user permissions"})]})]}),(0,n.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,n.jsx)(l.$,{onClick:()=>t.push("/auth/login"),className:"w-full",size:"lg",variant:e?"outline":"default",children:e?"Back to Login":"Try Again"}),e&&(0,n.jsx)(l.$,{onClick:()=>window.location.href="mailto:admin@vinifleet.com?subject=Account Access Request",className:"w-full",size:"lg",variant:"secondary",children:"Contact Administrator"})]})]})]})})}return p?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,n.jsx)(o.Zp,{className:"w-full max-w-md",children:(0,n.jsxs)(o.aR,{className:"text-center",children:[(0,n.jsx)("div",{className:"flex justify-center mb-4",children:(0,n.jsx)(d.A,{className:"h-8 w-8 text-green-600"})}),(0,n.jsx)(o.ZB,{className:"text-green-600",children:"Authentication Successful"}),(0,n.jsx)(o.BT,{children:"Redirecting you to your dashboard..."})]})})}):null}},3998:(e,t,r)=>{"use strict";r.d(t,{$:()=>o});var n=r(95155);r(12115);var a=r(32467),s=r(83101),i=r(64269);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:r,size:s,asChild:o=!1,...c}=e,u=o?a.DX:"button";return(0,n.jsx)(u,{"data-slot":"button",className:(0,i.cn)(l({variant:r,size:s,className:t})),...c})}},6132:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=(0,r(71847).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},18867:(e,t,r)=>{Promise.resolve().then(r.bind(r,2669))},19672:(e,t,r)=>{"use strict";r.d(t,{n:()=>s});var n=r(25959),a=r(89863);let s=(0,n.v)()((0,a.Zr)((e,t)=>({user:null,token:null,refreshToken:null,isAuthenticated:null,login:()=>{},logout:()=>{alert("You are logged out"),e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},setToken:(t,r)=>e({token:t,refreshToken:r}),setUser:t=>e({user:t}),setAuthenticated:t=>e({isAuthenticated:t}),checkAuth:async()=>{e({isAuthenticated:!!t().user})}}),{name:"vinicius-fleet-store",partialize:e=>Object.fromEntries(Object.entries(e).filter(e=>{let[t]=e;return!["user","token","refreshToken","isAuthenticated"].includes(t)}))}))},20063:(e,t,r)=>{"use strict";var n=r(47260);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},25959:(e,t,r)=>{"use strict";r.d(t,{v:()=>i});var n=r(12115);let a=e=>{let t,r=new Set,n=(e,n)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=n?n:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,s={setState:n,getState:a,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e))},i=t=e(n,a,s);return s},s=e=>{let t=(e=>e?a(e):a)(e),r=e=>(function(e,t=e=>e){let r=n.useSyncExternalStore(e.subscribe,n.useCallback(()=>t(e.getState()),[e,t]),n.useCallback(()=>t(e.getInitialState()),[e,t]));return n.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},i=e=>e?s(e):s},35299:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=(0,r(71847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},42529:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=(0,r(71847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},64269:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var n=r(2821),a=r(75889);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,n.$)(t))}},71847:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(12115);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:c="",children:u,iconNode:d,...h}=e;return(0,n.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:o?24*Number(l)/Number(a):l,className:s("lucide",c),...!u&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...d.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),o=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:o,...c}=r;return(0,n.createElement)(l,{ref:i,iconNode:t,className:s("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...c})});return r.displayName=a(e),r}},83101:(e,t,r)=>{"use strict";r.d(t,{F:()=>i});var n=r(2821);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=n.$,i=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:l}=t,o=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],n=null==l?void 0:l[e];if(null===t)return null;let s=a(t)||a(n);return i[e][s]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return s(e,o,null==t||null==(n=t.compoundVariants)?void 0:n.reduce((e,t)=>{let{class:r,className:n,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...c}[t]):({...l,...c})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},86948:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>l,Zp:()=>s,aR:()=>i});var n=r(95155);r(12115);var a=r(64269);function s(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function i(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function l(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",t),...r})}function o(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...r})}function c(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",t),...r})}},89863:(e,t,r)=>{"use strict";r.d(t,{Zr:()=>a});let n=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>n(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>n(t)(e)}}},a=(e,t)=>(r,a,s)=>{let i,l={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let n=e=>null===e?null:JSON.parse(e,void 0),a=null!=(t=r.getItem(e))?t:null;return a instanceof Promise?a.then(n):n(a)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1,c=new Set,u=new Set,d=l.storage;if(!d)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),r(...e)},a,s);let h=()=>{let e=l.partialize({...a()});return d.setItem(l.name,{state:e,version:l.version})},m=s.setState;s.setState=(e,t)=>(m(e,t),h());let f=e((...e)=>(r(...e),h()),a,s);s.getInitialState=()=>f;let g=()=>{var e,t;if(!d)return;o=!1,c.forEach(e=>{var t;return e(null!=(t=a())?t:f)});let s=(null==(t=l.onRehydrateStorage)?void 0:t.call(l,null!=(e=a())?e:f))||void 0;return n(d.getItem.bind(d))(l.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===l.version)return[!1,e.state];else{if(l.migrate){let t=l.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[n,s]=e;if(r(i=l.merge(s,null!=(t=a())?t:f),!0),n)return h()}).then(()=>{null==s||s(i,void 0),i=a(),o=!0,u.forEach(e=>e(i))}).catch(e=>{null==s||s(void 0,e)})};return s.persist={setOptions:e=>{l={...l,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(u.add(e),()=>{u.delete(e)})},l.skipHydration||g(),i||f}},91593:(e,t,r)=>{"use strict";r.d(t,{Xh:()=>i,i:()=>s,iF:()=>a,zl:()=>n});let n={ORDERED:"Ordered",IN_TRANSIT:"In Transit",CLEARING_CUSTOMS:"Clearing Customs",AT_PORT:"At Port",IN_LOCAL_DELIVERY:"In Local Delivery",DELIVERED:"Delivered"},a={PORT:"Port",WAREHOUSE:"Warehouse",CUSTOMS_OFFICE:"Customs Office",DEALERSHIP:"Dealership",DELIVERY_POINT:"Delivery Point"},s={OPERATIONAL:"Operational",TEMPORARILY_CLOSED:"Temporarily Closed",UNDER_MAINTENANCE:"Under Maintenance"},i={ADMIN:"Admin",NORMAL:"Normal",CEO:"CEO"}}},e=>{e.O(0,[5239,8441,1255,7358],()=>e(e.s=18867)),_N_E=e.O()}]);