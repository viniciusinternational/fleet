(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3522],{16932:(e,s,a)=>{Promise.resolve().then(a.bind(a,23701))},23701:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>w});var l=a(95155),t=a(12115),r=a(89715),n=a(16485),i=a(6132),d=a(39867),c=a(46046),o=a(65229),h=a(86948),m=a(3998),x=a(18332),u=a(86259),v=a(31120),f=a(75026),j=a(88112),g=a(77708),p=a(40357),y=a(20063);function w(){let e=(0,y.useRouter)(),[s,a]=(0,t.useState)([]),[w,N]=(0,t.useState)([]),[b,S]=(0,t.useState)(new Set),[T,k]=(0,t.useState)(null),[A,D]=(0,t.useState)(new Date().toISOString().split("T")[0]),[C,F]=(0,t.useState)(""),[O,P]=(0,t.useState)(!0),[E,B]=(0,t.useState)(!1),[I,Z]=(0,t.useState)(!1);(0,t.useEffect)(()=>{!async function(){try{P(!0);let e=await fetch("/api/vehicles?limit=1000");if(e.ok){let s=await e.json();if(s.success&&s.data){let e=s.data.vehicles||s.data;a(e)}}let s=await fetch("/api/owners?limit=1000");if(s.ok){let e=await s.json();if(e.success&&e.data){let s=e.data.owners||e.data;N(s)}}}catch(e){console.error("Error fetching data:",e)}finally{P(!1)}}()},[]);let _=s.filter(e=>b.has(e.id)),R=async()=>{if(T&&0!==_.length){B(!0);try{let s=await fetch("/api/delivery-notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ownerId:T.id,deliveryDate:A,notes:C||null,vehicleIds:Array.from(b)})}),a=await s.json();a.success?e.push("/admin/delivery/".concat(a.data.id)):alert("Failed to save delivery note: ".concat(a.error))}catch(e){console.error("Error saving delivery note:",e),alert("Failed to save delivery note. Please try again.")}finally{B(!1)}}},V=async()=>{if(T&&0!==_.length){Z(!0);try{let s=await fetch("/api/delivery-notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ownerId:T.id,deliveryDate:A,notes:C||null,vehicleIds:Array.from(b)})}),a=await s.json();if(a.success){let s={id:a.data.id,vehicles:_.map(e=>({id:e.id,vin:e.vin,make:e.make,model:e.model,year:e.year,color:e.color,status:e.status,trim:e.trim,engineType:e.engineType})),owner:T,deliveryDate:new Date(A),generatedAt:new Date,notes:C||void 0};(0,p.E)(s),e.push("/admin/delivery/".concat(a.data.id))}else alert("Failed to save delivery note: ".concat(a.error))}catch(e){console.error("Error generating and saving delivery note:",e),alert("Failed to generate and save delivery note. Please try again.")}finally{Z(!1)}}},z=T&&_.length>0;return O?(0,l.jsx)("div",{className:"container mx-auto p-6",children:(0,l.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Loading data..."})]})})}):(0,l.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[(0,l.jsx)(r.A,{className:"h-8 w-8 text-primary"}),"New Delivery Note"]}),(0,l.jsx)("p",{className:"text-muted-foreground mt-2",children:"Select vehicles and owner to create a new delivery note"})]})}),(0,l.jsx)(u.w,{}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-stretch",style:{height:"calc(100vh - 250px)"},children:[(0,l.jsxs)("div",{className:"lg:col-span-1 flex flex-col gap-6",children:[(0,l.jsxs)(h.Zp,{className:"flex-[0.3] flex flex-col",children:[(0,l.jsxs)(h.aR,{children:[(0,l.jsx)(h.ZB,{children:"Selected Vehicles"}),(0,l.jsx)(h.BT,{children:"Vehicles to include in the delivery note"})]}),(0,l.jsx)(h.Wu,{className:"flex-1 overflow-hidden min-h-0",children:(0,l.jsx)(j.H,{vehicles:_,onRemove:e=>{let s=new Set(b);s.delete(e),S(s)}})})]}),(0,l.jsxs)(h.Zp,{className:"flex-[0.7] flex flex-col",children:[(0,l.jsxs)(h.aR,{children:[(0,l.jsx)(h.ZB,{children:"Delivery Information"}),(0,l.jsx)(h.BT,{children:"Select owner and delivery details"})]}),(0,l.jsxs)(h.Wu,{className:"flex-1 overflow-auto space-y-4",children:[(0,l.jsx)(g.B,{owners:w,selectedOwner:T,onSelectOwner:k}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[(0,l.jsx)(n.A,{className:"h-4 w-4"}),"Delivery Date"]}),(0,l.jsx)("input",{type:"date",value:A,onChange:e=>D(e.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Notes"}),(0,l.jsx)(v.T,{placeholder:"Add any additional notes for this delivery...",value:C,onChange:e=>F(e.target.value),className:"min-h-[100px]"})]}),(0,l.jsx)(u.w,{}),!z&&(0,l.jsxs)(x.Fc,{children:[(0,l.jsx)(i.A,{className:"h-4 w-4"}),(0,l.jsx)(x.TN,{children:T||0!==_.length?T?"Please select at least one vehicle":"Please select an owner":"Please select at least one vehicle and an owner"})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(m.$,{onClick:V,disabled:!z||I,className:"w-full",size:"lg",children:I?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-background border-t-transparent rounded-full mr-2"}),"Generating & Saving..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Generate & Save"]})}),(0,l.jsx)(m.$,{onClick:R,disabled:!z||E,variant:"outline",className:"w-full",size:"lg",children:E?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-primary border-t-transparent rounded-full mr-2"}),"Saving..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Save"]})}),(0,l.jsxs)(m.$,{onClick:()=>{e.push("/admin/delivery")},variant:"ghost",className:"w-full",size:"lg",children:[(0,l.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Cancel"]})]}),z&&(0,l.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Generate & Save will create the note and download PDF"})]})]})]}),(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsxs)(h.Zp,{className:"h-full",children:[(0,l.jsxs)(h.aR,{children:[(0,l.jsx)(h.ZB,{children:"Available Vehicles"}),(0,l.jsx)(h.BT,{children:"Search and select vehicles to add to the delivery note"})]}),(0,l.jsx)(h.Wu,{children:(0,l.jsx)(f.T,{vehicles:s,selectedVehicleIds:b,onToggleVehicle:e=>{let s=new Set(b);s.has(e)?s.delete(e):s.add(e),S(s)},onToggleAll:e=>{e?S(new Set(s.map(e=>e.id))):S(new Set)}})})]})})]})]})}}},e=>{e.O(0,[3930,5033,5239,3637,4127,2673,3437,861,9915,5108,8441,1255,7358],()=>e(e.s=16932)),_N_E=e.O()}]);