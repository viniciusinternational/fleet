(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9766],{15144:(e,s,a)=>{Promise.resolve().then(a.bind(a,41435))},19408:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(71847).A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},23327:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(71847).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},41435:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>k});var r=a(95155),l=a(12115),t=a(20063),i=a(86948),n=a(3998),c=a(65142),d=a(76444),o=a(11186),m=a(18332),h=a(33667),x=a(17910),u=a(19408),p=a(20508),j=a(35626),f=a(61362),v=a(21873),N=a(23327),g=a(70532),w=a(57828),b=a(65229),y=a(46046);let k=()=>{let{id:e}=(0,t.useParams)(),s=(0,t.useRouter)(),[a,k]=(0,l.useState)(!1),[A,C]=(0,l.useState)(!1),[E,P]=(0,l.useState)(!1),[F,I]=(0,l.useState)(!1),[U,S]=(0,l.useState)(null),[J,M]=(0,l.useState)(!0),[q,L]=(0,l.useState)(null),[$,O]=(0,l.useState)({fullname:"",phone:"",email:"",role:"Normal",locationId:"",isActive:!0,avatar:"",password:"",confirmPassword:""}),[R,T]=(0,l.useState)({}),[_,z]=(0,l.useState)([]),[B,V]=(0,l.useState)(!0);if((0,l.useEffect)(()=>{(async()=>{if(e)try{var s,a;M(!0),L(null);let r=await fetch("/api/users/".concat(e),{cache:"no-store"});if(!r.ok){if(404===r.status)throw Error("User not found");throw Error("Failed to fetch user")}let l=await r.json();S(l),O({fullname:l.fullname||"",phone:l.phone||"",email:l.email||"",role:l.role||"Normal",locationId:(null==(s=l.location)?void 0:s.id)||"",isActive:null==(a=l.isActive)||a,avatar:l.avatar||"",password:"",confirmPassword:""})}catch(e){console.error("Error fetching user:",e),L(e instanceof Error?e.message:"Failed to fetch user")}finally{M(!1)}})()},[e]),(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/locations?limit=100",{cache:"no-store"});if(!e.ok)throw Error("Failed to fetch locations");let s=await e.json();z(s.locations||[])}catch(e){console.error("Error fetching locations:",e),z([])}finally{V(!1)}})()},[]),J)return(0,r.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Loading User..."}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Please wait while we fetch user details."})]})});if(q)return(0,r.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-destructive mb-4",children:"Error Loading User"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-6",children:q}),(0,r.jsx)(n.$,{onClick:()=>s.push("/admin/users"),children:"Back to Users"})]})});if(!U)return(0,r.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-destructive mb-4",children:"User Not Found"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-6",children:"The user you're trying to edit doesn't exist."}),(0,r.jsx)(n.$,{onClick:()=>s.push("/admin/users"),children:"Back to Users"})]})});let Z=(e,s)=>{O(a=>({...a,[e]:s})),R[e]&&T(s=>({...s,[e]:""}))},D=async a=>{if(a.preventDefault(),(()=>{let e={};return $.fullname.trim()||(e.fullname="Full name is required"),$.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($.email)||(e.email="Please enter a valid email address"):e.email="Email is required",$.phone.trim()||(e.phone="Phone number is required"),$.locationId&&"loading"!==$.locationId&&"no-locations"!==$.locationId||(e.locationId="Location is required"),$.password&&$.password.length<8&&(e.password="Password must be at least 8 characters long"),$.password&&$.password!==$.confirmPassword&&(e.confirmPassword="Passwords do not match"),T(e),0===Object.keys(e).length})()){k(!0);try{if(!$.locationId||"loading"===$.locationId||"no-locations"===$.locationId){T({locationId:"Please select a valid location"}),k(!1);return}if(!_.find(e=>e.id===$.locationId)){T({locationId:"Selected location not found"}),k(!1);return}let a={fullname:$.fullname,phone:$.phone,email:$.email,role:$.role,locationId:$.locationId,isActive:$.isActive,avatar:$.avatar||void 0};$.password&&(a.password=$.password);let r=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to update user")}C(!0),setTimeout(()=>{s.push("/admin/users")},2e3)}catch(e){console.error("Failed to update user:",e),L(e instanceof Error?e.message:"Failed to update user")}finally{k(!1)}}};return(0,r.jsx)("div",{className:"min-h-screen bg-background",children:(0,r.jsxs)("div",{className:"container mx-auto px-6 py-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,r.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>s.push("/admin/users"),className:"p-2",children:(0,r.jsx)(j.A,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit User"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"Update user information and settings"})]})]})}),A&&(0,r.jsxs)(m.Fc,{className:"mb-6 border-green-200 bg-green-50",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 text-green-600"}),(0,r.jsx)(m.TN,{className:"text-green-800",children:"User updated successfully! Redirecting to user list..."})]}),(0,r.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[(0,r.jsxs)(i.Zp,{children:[(0,r.jsx)(i.aR,{children:(0,r.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(p.A,{className:"h-5 w-5"}),"User Information"]})}),(0,r.jsxs)(i.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"fullname",children:"Full Name *"}),(0,r.jsx)(c.p,{id:"fullname",placeholder:"Enter full name",value:$.fullname,onChange:e=>Z("fullname",e.target.value),className:R.fullname?"border-red-500":""}),R.fullname&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:R.fullname})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"email",children:"Email Address *"}),(0,r.jsx)(c.p,{id:"email",type:"email",placeholder:"Enter email address",value:$.email,onChange:e=>Z("email",e.target.value),className:R.email?"border-red-500":""}),R.email&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:R.email})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"phone",children:"Phone Number *"}),(0,r.jsx)(c.p,{id:"phone",placeholder:"Enter phone number",value:$.phone,onChange:e=>Z("phone",e.target.value),className:R.phone?"border-red-500":""}),R.phone&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:R.phone})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"role",children:"Role *"}),(0,r.jsxs)(o.l6,{value:$.role,onValueChange:e=>Z("role",e),children:[(0,r.jsx)(o.bq,{children:(0,r.jsx)(o.yv,{placeholder:"Select role"})}),(0,r.jsxs)(o.gC,{children:[(0,r.jsx)(o.eb,{value:"Normal",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.A,{className:"h-4 w-4"}),"Normal User"]})}),(0,r.jsx)(o.eb,{value:"Admin",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"h-4 w-4"}),"Administrator"]})}),(0,r.jsx)(o.eb,{value:"CEO",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"h-4 w-4"}),"CEO"]})})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"locationId",children:"Assigned Location *"}),(0,r.jsxs)(o.l6,{value:$.locationId,onValueChange:e=>Z("locationId",e),children:[(0,r.jsx)(o.bq,{className:R.locationId?"border-red-500":"",children:(0,r.jsx)(o.yv,{placeholder:"Select a location"})}),(0,r.jsx)(o.gC,{children:B?(0,r.jsx)(o.eb,{value:"loading",disabled:!0,children:"Loading locations..."}):_.length>0?_.map(e=>(0,r.jsx)(o.eb,{value:e.id,children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.A,{className:"h-4 w-4"}),e.name," - ",e.type]})},e.id)):(0,r.jsx)(o.eb,{value:"no-locations",disabled:!0,children:"No locations available"})})]}),R.locationId&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:R.locationId})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"avatar",children:"Avatar URL (Optional)"}),(0,r.jsx)(c.p,{id:"avatar",placeholder:"Enter avatar URL",value:$.avatar,onChange:e=>Z("avatar",e.target.value)})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h4",{className:"font-medium",children:"Authentication"}),(0,r.jsxs)(m.Fc,{children:[(0,r.jsx)(N.A,{className:"h-4 w-4"}),(0,r.jsx)(m.TN,{children:"Leave password fields empty if you don't want to change the password."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"password",children:"New Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.p,{id:"password",type:E?"text":"password",placeholder:"Enter new password (optional)",value:$.password,onChange:e=>Z("password",e.target.value),className:R.password?"border-red-500 pr-10":"pr-10"}),(0,r.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>P(!E),children:E?(0,r.jsx)(g.A,{className:"h-4 w-4"}):(0,r.jsx)(w.A,{className:"h-4 w-4"})})]}),R.password&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:R.password}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Password must be at least 8 characters long"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"confirmPassword",children:"Confirm New Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.p,{id:"confirmPassword",type:F?"text":"password",placeholder:"Confirm new password",value:$.confirmPassword,onChange:e=>Z("confirmPassword",e.target.value),className:R.confirmPassword?"border-red-500 pr-10":"pr-10"}),(0,r.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>I(!F),children:F?(0,r.jsx)(g.A,{className:"h-4 w-4"}):(0,r.jsx)(w.A,{className:"h-4 w-4"})})]}),R.confirmPassword&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:R.confirmPassword})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(h.d,{id:"isActive",checked:$.isActive,onCheckedChange:e=>Z("isActive",e)}),(0,r.jsx)(d.J,{htmlFor:"isActive",children:"User is active"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 mt-8 pt-6 border-t",children:[(0,r.jsxs)(n.$,{type:"button",variant:"outline",onClick:()=>s.push("/admin/users"),disabled:a,children:[(0,r.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Cancel"]}),(0,r.jsx)(n.$,{type:"submit",disabled:a,className:"min-w-[120px]",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Update User"]})})]})]})]})})}}},e=>{e.O(0,[5239,3637,4127,2673,3437,8430,8441,1255,7358],()=>e(e.s=15144)),_N_E=e.O()}]);