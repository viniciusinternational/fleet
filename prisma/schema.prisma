generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String    @id @default(cuid())
  firstName   String
  lastName    String
  phone       String
  email       String    @unique
  role        Role      @default(NORMAL)
  locationId  String
  createdAt   DateTime  @default(now())
  lastLogin   DateTime?
  isActive    Boolean   @default(true)
  avatar      String?
  password    String?
  permissions Json?
  location    Location  @relation(fields: [locationId], references: [id])

  @@map("users")
}

model Location {
  id           String         @id @default(cuid())
  name         String
  type         LocationType
  latitude     Float
  longitude    Float
  street       String
  city         String
  state        String?
  country      String
  postalCode   String?
  contactName  String?
  contactPhone String?
  contactEmail String?
  status       LocationStatus @default(OPERATIONAL)
  lastUpdated  DateTime       @default(now())
  notes        String?
  users        User[]
  vehicles     Vehicle[]      @relation("VehicleLocation")

  @@map("locations")
}

model Vehicle {
  id                   String            @id @default(cuid())
  vin                  String            @unique
  make                 String
  model                String
  year                 Int
  color                String
  trim                 String
  engineType           String
  fuelType             FuelType
  weightKg             Float
  lengthMm             Float?
  widthMm              Float?
  heightMm             Float?
  orderDate            DateTime
  status               VehicleStatus     @default(ORDERED)
  estimatedDelivery    DateTime
  customsStatus        CustomsStatus     @default(PENDING)
  customsClearanceDate DateTime?
  importDuty           Float
  customsNotes         String?
  currentLocationId    String
  ownerId              String
  shippingDetailsId    String?           @unique
  trackingHistory      TrackingEvent[]
  vehicleDocuments     VehicleDocument[]
  vehicleImages        VehicleImage[]
  currentLocation      Location          @relation("VehicleLocation", fields: [currentLocationId], references: [id])
  owner                Owner             @relation(fields: [ownerId], references: [id])
  shippingDetails      ShippingDetails?  @relation(fields: [shippingDetailsId], references: [id], onDelete: Cascade)

  @@map("vehicles")
}

model ShippingDetails {
  id                  String    @id @default(cuid())
  originPort          String
  destinationPort     String
  shippingCompany     String
  vesselName          String?
  containerNumber     String?
  bookingNumber       String
  departureDate       DateTime?
  expectedArrivalDate DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  documents           Json?
  vehicleId           String    @unique
  vehicle             Vehicle?

  @@map("shipping_details")
}

model Owner {
  id            String         @id @default(cuid())
  name          String
  email         String
  phone         String
  address       String
  nationality   String
  idNumber      String         @unique
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  vehicles      Vehicle[]
  deliveryNotes DeliveryNote[]

  @@map("owners")
}

model VehicleImage {
  id        String  @id @default(cuid())
  url       String
  alt       String
  caption   String?
  isPrimary Boolean @default(false)
  data      String
  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("vehicle_images")
}

model TrackingEvent {
  id        String        @id @default(cuid())
  timestamp DateTime      @default(now())
  location  String
  status    VehicleStatus
  notes     String?
  vehicleId String
  vehicle   Vehicle       @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("tracking_events")
}

model VehicleDocument {
  id        String       @id @default(cuid())
  name      String
  url       String
  type      DocumentType @default(OTHER)
  vehicleId String
  vehicle   Vehicle      @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("vehicle_documents")
}

enum Role {
  ADMIN
  NORMAL
  CEO
}

enum LocationType {
  PORT
  WAREHOUSE
  CUSTOMS_OFFICE
  DEALERSHIP
  DELIVERY_POINT
}

enum LocationStatus {
  OPERATIONAL
  TEMPORARILY_CLOSED
  UNDER_MAINTENANCE
}

enum VehicleStatus {
  ORDERED
  IN_TRANSIT
  CLEARING_CUSTOMS
  AT_PORT
  IN_LOCAL_DELIVERY
  DELIVERED
}

enum FuelType {
  GASOLINE
  DIESEL
  ELECTRIC
  HYBRID
}

enum CustomsStatus {
  PENDING
  IN_PROGRESS
  CLEARED
  HELD
}

enum DocumentType {
  BILL_OF_LADING
  CUSTOMS_DECLARATION
  INVOICE
  INSURANCE
  OTHER
}

model DeliveryNote {
  id          String   @id @default(cuid())
  ownerId     String
  deliveryDate DateTime
  notes       String?
  vehicleIds  Json     // Array of vehicle IDs
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  owner       Owner    @relation(fields: [ownerId], references: [id])

  @@map("delivery_notes")
}
